{% extends "base.html" %}

{% block title %}{{ page|title }} - Django Components UI{% endblock %}

{% block content %}
<div class="flex min-h-screen container mx-auto">
        {% include "demo/docs/partials/sidebar.html" %}

        <!-- Main Content Area -->
        <div class="flex-1 flex">
        <!-- Content -->
            <main id="content" class="flex-1 px-8 py-12">
                {% include content_template %}
            </main>

            <!-- Table of Contents -->
            <aside id="toc" class="hidden xl:block w-64 shrink-0 sticky top-16 max-h-[calc(100vh-4rem)] overflow-y-auto pt-12 pb-16 pr-6">
                <div class="text-sm">
                    <h3 class="font-semibold text-base-content/60 uppercase tracking-wider mb-4">On this page</h3>
                    <ul id="toc-list" class="space-y-2">
                    <!-- TOC will be generated by JavaScript -->
                    </ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
    // Auto-generate TOC from H2 and H3 elements
        function updateTOC() {
            const tocList = document.getElementById('toc-list');
            const headings = document.querySelectorAll('#content h2, #content h3');

            if (headings.length === 0) {
                tocList.innerHTML = '<li class="text-base-content/50 text-xs">No sections available</li>';
                return;
            }

            tocList.innerHTML = '';
            headings.forEach((heading, index) => {
                const id = heading.id || `section-${index}`;
                if (!heading.id) heading.id = id;

                const li = document.createElement('li');
                const isH3 = heading.tagName.toLowerCase() === 'h3';
                const linkClass = isH3
                    ? 'pl-4 text-sm text-base-content/60 hover:text-base-content transition-colors'
                    : 'text-base-content/70 hover:text-base-content transition-colors';

                li.innerHTML = `<a href="#${id}" class="${linkClass}">${heading.textContent}</a>`;
                tocList.appendChild(li);
            });
        }

    // Update TOC when content changes
        document.body.addEventListener('htmx:afterSettle', updateTOC);

    // Initial TOC generation
        document.addEventListener('DOMContentLoaded', updateTOC);

    // Smooth scrolling for TOC links
        document.addEventListener('click', function(e) {
            if (e.target.matches('#toc a')) {
                e.preventDefault();
                const target = document.querySelector(e.target.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            }
        });

    // Re-highlight code after HTMX content loads
        document.body.addEventListener('htmx:afterSettle', function() {
            if (window.Prism) {
                Prism.highlightAll();
            }
        });

    // Initial code highlighting
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                Prism.highlightAll();
            }
        });
    </script>
{% endblock %}