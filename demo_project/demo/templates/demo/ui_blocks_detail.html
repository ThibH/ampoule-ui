{% extends 'base.html' %}
{% load static %}

{% block title %}{{ block_data.name }} - {{ category_name }} - UI Blocks{% endblock %}

{% block content %}
<div class="min-h-screen bg-base-100">
    <!-- Header with Breadcrumbs -->
    <div class="bg-base-200 border-b border-base-300">
        <div class="container mx-auto px-6 py-8">
            <!-- Breadcrumbs -->
            <div class="mb-6">
                <c-breadcrumbs>
                    {% for crumb in breadcrumbs %}
                        {% if crumb.url %}
                            {% if crumb.url_args %}
                                <c-breadcrumb href="{% url crumb.url crumb.url_args.0 %}" label="{{ crumb.name }}" />
                            {% else %}
                                <c-breadcrumb href="{% url crumb.url %}" label="{{ crumb.name }}" />
                            {% endif %}
                        {% else %}
                            <c-breadcrumb label="{{ crumb.name }}" />
                        {% endif %}
                    {% endfor %}
                </c-breadcrumbs>
            </div>

            <!-- Block Header -->
            <div class="flex items-start justify-between">
                <div class="max-w-3xl">
                    <div class="flex items-center gap-4 mb-4">
                        <!-- Block Icon -->
                        {% if block_id == 'headers' %}
                            <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center">
                                <c-icon name="layout-template" class="w-8 h-8 text-primary" />
                            </div>
                        {% elif block_id == 'cards' %}
                            <div class="w-16 h-16 bg-secondary/10 rounded-lg flex items-center justify-center">
                                <c-icon name="square-stack" class="w-8 h-8 text-secondary" />
                            </div>
                        {% elif block_id == 'dashboards' %}
                            <div class="w-16 h-16 bg-info/10 rounded-lg flex items-center justify-center">
                                <c-icon name="chart-bar" class="w-8 h-8 text-info" />
                            </div>
                        {% elif block_id == 'stats' %}
                            <div class="w-16 h-16 bg-accent/10 rounded-lg flex items-center justify-center">
                                <c-icon name="chart-line" class="w-8 h-8 text-accent" />
                            </div>
                        {% elif block_id == 'auth-forms' %}
                            <div class="w-16 h-16 bg-warning/10 rounded-lg flex items-center justify-center">
                                <c-icon name="shield-check" class="w-8 h-8 text-warning" />
                            </div>
                        {% endif %}

                        <div>
                            <h1 class="text-3xl font-bold text-base-content mb-2">{{ block_data.name }}</h1>
                            <p class="text-lg text-base-content/70">{{ block_data.description }}</p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-3">
                    <!-- Removed Copy All Code and Back buttons -->
                </div>
            </div>
        </div>
    </div>

    <!-- Block Content with TOC -->
    <div class="flex min-h-screen container mx-auto">
        <!-- Main Content Area -->
        <div class="flex-1 flex">
            <!-- Content -->
            <main id="content" class="flex-1 px-8 py-12 max-w-7xl">
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold text-base-content mb-6">{{ block_data.name }} Components</h2>
                    {% include block_data.template %}
                </div>
            </main>

            <!-- Table of Contents -->
            <aside id="toc" class="hidden xl:block w-64 shrink-0 sticky top-16 max-h-[calc(100vh-4rem)] overflow-y-auto pt-12 pb-16 pr-6">
                <div class="text-sm">
                    <h3 class="font-semibold text-base-content/60 uppercase tracking-wider mb-4">On this page</h3>
                    <ul id="toc-list" class="space-y-2">
                        <!-- TOC will be generated by JavaScript -->
                    </ul>
                </div>
            </aside>
        </div>
    </div>

        <!-- Usage Instructions -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Installation -->
            <div class="bg-base-100 border border-base-300 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-base-content mb-4">
                    <c-icon name="download" class="mr-2" />
                    Installation
                </h3>
                <p class="text-base-content/70 text-sm mb-4">
                    These components are built with Django Components UI. Make sure you have it installed:
                </p>
                <div class="bg-base-200 rounded-lg p-4">
                    <code class="text-sm text-base-content">pip install django-components-ui</code>
                </div>
            </div>

            <!-- Usage -->
            <div class="bg-base-100 border border-base-300 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-base-content mb-4">
                    <c-icon name="code" class="mr-2" />
                    Usage
                </h3>
                <p class="text-base-content/70 text-sm mb-4">
                    Copy the code from the components above and customize as needed for your project.
                </p>
                <div class="space-y-2">
                    <div class="flex items-center text-xs text-base-content/60">
                        <c-icon name="check" class="w-4 h-4 mr-2 text-success" />
                        <span>Fully responsive</span>
                    </div>
                    <div class="flex items-center text-xs text-base-content/60">
                        <c-icon name="check" class="w-4 h-4 mr-2 text-success" />
                        <span>Accessible by default</span>
                    </div>
                    <div class="flex items-center text-xs text-base-content/60">
                        <c-icon name="check" class="w-4 h-4 mr-2 text-success" />
                        <span>Easy to customize</span>
                    </div>
                </div>
            </div>

            <!-- Customization -->
            <div class="bg-base-100 border border-base-300 rounded-lg p-6">
                <h3 class="text-lg font-semibold text-base-content mb-4">
                    <c-icon name="palette" class="mr-2" />
                    Customization
                </h3>
                <p class="text-base-content/70 text-sm mb-4">
                    Customize colors, spacing, and styling using Tailwind CSS classes or your own CSS.
                </p>
                <c-button variant="outline" size="sm" href="{% url 'demo:docs' %}">
                    <c-icon name="book-open" class="mr-2" />
                    View Docs
                </c-button>
            </div>
        </div>

        <!-- Related Blocks -->
        <div class="border-t border-base-300 pt-12 mt-16">
            <div class="text-center mb-8">
                <h3 class="text-xl font-semibold text-base-content mb-2">Related Blocks</h3>
                <p class="text-base-content/70">Discover more blocks in the {{ category_name }} category</p>
            </div>

            <div class="flex flex-wrap justify-center gap-4">
                <c-button variant="outline" href="{% url 'demo:ui_blocks_category' category %}">
                    <c-icon name="grid-3x3" class="mr-2" />
                    View All {{ category_name }}
                </c-button>
                
                <c-button variant="ghost" href="{% url 'demo:ui_blocks' %}">
                    <c-icon name="home" class="mr-2" />
                    All UI Blocks
                </c-button>

                <c-button variant="ghost" href="{% url 'demo:docs' %}">
                    <c-icon name="book-open" class="mr-2" />
                    Documentation
                </c-button>
            </div>
        </div>
    </div>

    <script>
    // Auto-generate TOC from H2 elements only (block titles)
    function updateTOC() {
        const tocList = document.getElementById('toc-list');
        const headings = document.querySelectorAll('#content h2');

        if (headings.length === 0) {
            tocList.innerHTML = '<li class="text-base-content/50 text-xs">No sections available</li>';
            return;
        }

        tocList.innerHTML = '';
        headings.forEach((heading, index) => {
            const id = heading.id || `section-${index}`;
            if (!heading.id) heading.id = id;

            const li = document.createElement('li');
            const linkClass = 'text-base-content/70 hover:text-base-content transition-colors';

            li.innerHTML = `<a href="#${id}" class="${linkClass}">${heading.textContent}</a>`;
            tocList.appendChild(li);
        });
    }

    // Update TOC when content changes
    document.body.addEventListener('htmx:afterSettle', updateTOC);

    // Initial TOC generation
    document.addEventListener('DOMContentLoaded', updateTOC);

    // Smooth scrolling for TOC links
    document.addEventListener('click', function(e) {
        if (e.target.matches('#toc a')) {
            e.preventDefault();
            const target = document.querySelector(e.target.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth' });
            }
        }
    });

    // Re-highlight code after HTMX content loads
    document.body.addEventListener('htmx:afterSettle', function() {
        if (window.Prism) {
            Prism.highlightAll();
        }
    });

    // Initial code highlighting
    document.addEventListener('DOMContentLoaded', function() {
        if (window.Prism) {
            Prism.highlightAll();
        }
    });
    </script>
</div>
{% endblock %} 