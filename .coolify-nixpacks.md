# Déploiement Coolify avec Nixpacks

## Configuration Coolify

### 1. Paramètres de base
- **Build Pack** : `nixpacks`
- **Base Directory** : `documentation`
- **Port** : `8000`

### 2. Variables d'environnement
```env
DEBUG=False
SECRET_KEY=votre-secret-key-super-securisee
ALLOWED_HOSTS=votre-domaine.com,www.votre-domaine.com
DJANGO_SETTINGS_MODULE=documentation.settings_production
PORT=8000
```

### 3. Configuration du repository
- **Repository** : votre repository Git
- **Branch** : `main`
- **Auto Deploy** : activé

## Fichiers importants créés

1. **`nixpacks.toml`** - Configuration Nixpacks
2. **`documentation/requirements.txt`** - Dépendances avec gunicorn
3. **`documentation/settings_production.py`** - Settings production

## Résolution du problème "restart unhealthy"

Le problème vient probablement de :

1. **Mauvais répertoire de base** : Utilisez `documentation` comme Base Directory
2. **Port incorrect** : Assurez-vous que PORT=8000 dans les variables d'environnement
3. **Commande de démarrage** : Le `nixpacks.toml` configure automatiquement gunicorn

## Vérifications

### Health Check
Nixpacks démarre automatiquement sur le port 8000. Coolify vérifie :
```
http://localhost:8000/
```

### Logs à vérifier
Dans Coolify, vérifiez les logs pour :
- Erreurs de collectstatic
- Erreurs de démarrage gunicorn
- Problèmes de variables d'environnement

## Commandes de test local

```bash
# Test de la configuration
cd documentation
export DJANGO_SETTINGS_MODULE=documentation.settings_production
export DEBUG=False
export SECRET_KEY=test-key
export ALLOWED_HOSTS=localhost

# Test du serveur
python manage.py runserver 8000
```

## Structure finale attendue par Nixpacks

```
djangocomponents/
├── nixpacks.toml                       # Configuration Nixpacks
├── documentation/                      # Base Directory
│   ├── requirements.txt                # Dépendances Python
│   ├── settings_production.py          # Settings production  
│   ├── manage.py
│   └── documentation/
│       ├── settings.py
│       └── wsgi.py
```

## Si le problème persiste

1. **Vérifiez les logs de build** dans Coolify
2. **Testez localement** avec les mêmes variables d'environnement
3. **Vérifiez le health check** : l'app doit répondre sur `/`